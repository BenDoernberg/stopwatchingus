<!DOCTYPE html> 
<html> 
    <head> 
      <meta charset="utf-8"> 
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
      <title></title> 
      <meta name="description" content=""> 
      <meta name="viewport" content="width=device-width"> 
      <link rel="stylesheet" href="/css/bootstrap.min.css"> 
      <link rel="stylesheet" href="/css/bootstrap-theme.min.css"> 
      <link rel="stylesheet" href="/css/main.css"> 
      <script type="text/javascript" src="//use.http://typekit.net/cdj3zbf.js"></script>
      <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
      <!--[if lt IE 9]> <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> 
    </head>
    <body>
      <!-- Static navbar -->
      <div class="navbar navbar-default navbar-static-top col-lg-10 col-lg-2 col-lg-offset-1">
        <div class="container">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="#"><img src="/img/logo-header.png"></a>
            </div>
            <!--
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="#">SIGN UP</a></li>
                <li><a href="#">VOLUNTEER</a></li>
                <li><a href="#">BLOG</a></li>
                <li><a href="#">FAQ</a></li>
              </ul>
            </div> --> 
          </div>
        </div>
      </div>

      <div class="jumbotron default">
        <div class="container">
          <div class="col-lg-10 col-lg-offset-1">
            <h2>This October 26th, 2013 in Washington, D.C. and around the country</h2>
            <h1>A Rally Against Mass Surveillance</h1>
          </div>

            <div class="signupform">
             <form class="mcsignup emailsignup form-horizontal" role="form">
              <div class="form-group">
                <label for="inputEmail1" class="col-lg-2 control-label nopad">NAME:</label>
                <div class="col-lg-8 nopad">
                  <input type="email" id="inputEmail1" class="flatinput hero-name-input" name="name" >
                </div>
              </div>
              <div class="form-group">
                <label for="email1" class="col-lg-2 control-label nopad">EMAIL:</label>
                <div class="col-lg-8 nopad">
                  <input type="text" id="email1" class="flatinput email-field" name="email">
                </div> 
              </div>
              <div class="form-group" style="display: none;">
                <label for="inputEmail1" class="col-lg-2 control-label nopad">PHONE:</label>
                <div class="col-lg-8 nopad">
                  <input type="email" id="inputEmail1" class="flatinput" name="phone">
                </div>
              </div>
              <div class="form-group" style="display: none;">
                <label for="email1" class="col-lg-2 control-label nopad">ZIPCODE:</label>
                <div class="col-lg-8 nopad">
                  <input type="text" id="email1" class="flatinput email-field" name="zipcode">
                </div> 

              </div>
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-danger btn-lg signup validate-submit">SIGN UP TO ATTEND</button>
                <div id="status1">&#160;</div>
            </div>
          </form>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="main row">
          <div class="col-xs-12 col-sm-8 col-md-8">
            {{content}}
          </div>
          <div class="col-xs-12 col-sm-4 col-md-4">
            {% include share.html %}
            {% include sidebar.html %}
          </div>
        </div>
      </div>

      <div class="footer">
        <div class="container">
          <div class="col-lg-10 col-lg-offset-1">
            <img src="/img/logo-header.png" class="fade">
            <span class="pull-right">
              <img src="/img/cc.png" class="pull-right">
              <br/><br/>
              <p>This work is licensed under a Creative Commons Attribution 3.0 Unported License.</p>
            </span>
          </div>
        </div>
      </div>
      <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
      <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.form/3.32/jquery.form.min.js"></script>
      <script>
      $.fn.serializeObject = function() {
          var o = {};
          var a = this.serializeArray();
          $.each(a, function() {
              if (o[this.name] !== undefined) {
                  if (!o[this.name].push) {
                      o[this.name] = [o[this.name]];
                  }
                  o[this.name].push(this.value || '');
              } else {
                  o[this.name] = this.value || '';
              }
          });
          return o;
      };
      $(document).ready( function () {
          // I only have one form on the page but you can be more specific if need be.
          $('.hero-name-input').on('focus', function (){ 
            $('.jumbotron .form-group').slideDown(250);
          })

          $('.mcsignup').on('submit', function(ev){
            var form = $(ev.currentTarget);
            var data = form.serializeObject();
            $.ajax({
              url: 'http://skipchimp.herokuapp.com/subscribe',
              data: data,
              type: 'POST'
            })
            return false;
          })
      });

      </script>
      <script src="/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="//use.typekit.net/cdj3zbf.js"></script>
      <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
      <script type="text/javascript" src="/js/mailgunvalidate.js"></script>
      <script type="text/javascript">
            
            $(function() {
                // clear username input field
                $('.email-field').val('');

                // capture all enter and do nothing
                $('.email-field').keypress(function(e) {
                    if(e.which == 13) {
                        $('.email-field').trigger('focusout');
                        return false;
                    }
                });

                // capture clicks on validate and do nothing
                $('.validate-submit').click(function() {
                    return false;
                });

                // attach jquery plugin to validate address
                $('.email-field').mailgun_validator({
                    api_key: 'pubkey-2pjzaxwf7x7thcgvc7u0xhi17yrp1lv3',
                    in_progress: validation_in_progress,
                    success: validation_success,
                    error: validation_error,
                });
            });


            function validation_in_progress() {
                rdiv = $('#' + getSelectedFormError())

                // empty out anything we had before
                rdiv.empty()
            }


            function validation_success(data) {
                rdiv = $('#' + getSelectedFormError())

                // get icon and suggestion strings
                //icon_str = get_icon_str(data['is_valid'], data['did_you_mean'] != null);
                sugg_str = get_suggestion_str(data['is_valid'], data['did_you_mean'])

                // clear out any previous text
                rdiv.empty()

                // set icon and suggestion string
                //rdiv.append(icon_str + ' ' + sugg_str);
                rdiv.append(sugg_str);
            }


            function validation_error(error_message) {
                rdiv = $('#' + getSelectedFormError())

                // empty out anything we had before
                rdiv.empty()

                // show in progress
                rdiv.append(error_message);
            }


            function get_suggestion_str(is_valid, alternate) {
                if (alternate) {
                    return '<b class="red">Did you mean:</b> ' +
                           '<b><i>' +  alternate + '</i></b>';
                }

                if (is_valid) {
                    return "Address is valid.";
                }

                return "Address is invalid."
            }
            /**
            function get_icon_str(is_valid, has_alternate) {
                if (is_valid && !has_alternate) {
                    return "<img src='icons/valid-color.png' style='vertical-align:middle'/>";
                }

                if (is_valid && has_alternate) {
                    return "<img src='icons/did-you-mean-color.png' style='vertical-align:middle'/>";
                }

                if (!is_valid) {
                    return "<img src='icons/invalid-color.png' style='vertical-align:middle'/>";
                }
            }
            **/
            function getSelectedFormError(){
                if($('#email2').val())
                  return "status2"
                return "status1"
            } 
      </script>
    </body>
</html>
